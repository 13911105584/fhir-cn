<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>FHIR 中文版</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="首页 &amp;gt; 实现 &amp;gt;方法定义框架 operation
2.2.0 扩展方法 Extended Operations on the RESTful APIRESTful API 中定义了某些资源类型的一些常见的交互/接口(增删改查)。这些交互/接口遵循 Restful范式，通过增删改查CRUD操作来管理资源的状态。尽管这些接口能解决大多数的问题，但仍然有一些特殊的功能只有使用一种类似RPC">
<meta property="og:type" content="website">
<meta property="og:title" content="FHIR 中文版">
<meta property="og:url" content="http://wanghaisheng.github.io/fhir-cn/home/index.html/impl/operations.html">
<meta property="og:site_name" content="FHIR 中文版">
<meta property="og:description" content="首页 &amp;gt; 实现 &amp;gt;方法定义框架 operation
2.2.0 扩展方法 Extended Operations on the RESTful APIRESTful API 中定义了某些资源类型的一些常见的交互/接口(增删改查)。这些交互/接口遵循 Restful范式，通过增删改查CRUD操作来管理资源的状态。尽管这些接口能解决大多数的问题，但仍然有一些特殊的功能只有使用一种类似RPC">
<meta property="og:updated_time" content="2015-08-17T02:13:01.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="FHIR 中文版">
<meta name="twitter:description" content="首页 &amp;gt; 实现 &amp;gt;方法定义框架 operation
2.2.0 扩展方法 Extended Operations on the RESTful APIRESTful API 中定义了某些资源类型的一些常见的交互/接口(增删改查)。这些交互/接口遵循 Restful范式，通过增删改查CRUD操作来管理资源的状态。尽管这些接口能解决大多数的问题，但仍然有一些特殊的功能只有使用一种类似RPC">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href='http://fonts.useso.com/css?family=Open+Sans:300,400,600&subset=latin,latin-ext' rel='stylesheet'>  <link rel="stylesheet" href="../css/style.css" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-50564678-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>
<body>
  <div id="container">
    <div class='navbar menu'>
    
        <a href="/fhir-cn/home/index.html" title="首页">
            <div class="menu-action"><img src="../images/icon-home.png"></div>
        </a>
    
        <a href="/fhir-cn/doc/documentation.html" title="文档">
            <div class="menu-action"><img src="../images/icon-documentation.png"></div>
        </a>
    
        <a href="/fhir-cn/impl/implementation.html" title="实现">
            <div class="menu-action"><img src="../images/icon-implementation.png"></div>
        </a>
    
        <a href="/fhir-cn/res/resourcelist.html" title="资源">
            <div class="menu-action"><img src="../images/icon-res.png"></div>
        </a>
    
        <a href="/fhir-cn/clin/clinical.html" title="临床类资源">
            <div class="menu-action"><img src="../images/icon-clinical.png"></div>
        </a>
    
        <a href="/fhir-cn/admin/administration.html" title="行政管理类资源">
            <div class="menu-action"><img src="../images/icon-administration.png"></div>
        </a>
    
        <a href="/fhir-cn/infra/infrastructure.html" title="基础架构类资源">
            <div class="menu-action"><img src="../images/icon-infrastructure.png"></div>
        </a>
    
        <a href="https://github.com/hl7-fhir/hl7-fhir.github.io" title="github">
            <div class="menu-action"><img src="../images/github.png"></div>
        </a>
    
</div>

    <div id="wrap">
      <div class='header'>
    
        <h1> FHIR 中文版 </h1>
    
</div>

      <div class="outer">
        <section id="main"><article id="page-undefined" class="article article-type-page" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <footer class="article-footer">
        
        

      </footer>
      <div class="article-entry" itemprop="articleBody">
        
          <p>  <a href="../home/index.html">首页</a> &gt; <a href="implementation.html">实现</a> &gt;<strong>方法定义框架 operation</strong></p>
<h3 id="2-2-0_扩展方法_Extended_Operations_on_the_RESTful_API">2.2.0 扩展方法 Extended Operations on the RESTful API</h3><p>RESTful API 中定义了某些资源类型的一些常见的交互/接口(增删改查)。这些交互/接口遵循 Restful范式，通过增删改查CRUD操作来管理资源的状态。尽管这些接口能解决大多数的问题，但仍然有一些特殊的功能<br>只有使用一种类似RPC的范式才能更加高效的解决，也就是我们所说的根据输入来进行输出的operation 方法。这部分介绍了轻量级的operation 框架来无缝的扩展原有的<br>RESTful API。</p>
<p>Operations 拥有如下的特性:</p>
<ul>
<li>每个 Operation 都有名称</li>
<li>每个 Operation 都有入参和出参</li>
<li>入参出参中参数可以是资源、数据类型或查询参数</li>
<li>Operation和 RESTful API 的安全相关的处理一致</li>
<li>Operation 的URI节点是基于现有的 RESTful API的寻址方案的。</li>
<li>Operation 可以利用现有的资源</li>
<li>Operation 可以是针对某个资源，或是某种资源类型或者是整个服务器而言</li>
</ul>
<h4 id="2-2-0-1_FHIR中定义好的_Operation_FHIR_defined_Operations">2.2.0.1 FHIR中定义好的 Operation FHIR defined Operations</h4><p>FHIR标准中定义了一些 Operation:</p>
<table>
<thead>
<tr>
<th>operation 名称</th>
<th>节点</th>
</tr>
</thead>
<tbody>
<tr>
<td>资源内容的校验</td>
<td>[base]/[Resource]/$validate</td>
<td>[base]/[Resource]/[id]/$validate</td>
</tr>
<tr>
<td>获取资源的profiles, tags, and security 标签</td>
<td>[base]/$meta</td>
<td>[base]/[Resource]/$meta</td>
<td>[base]/[Resource]/[id]/$meta</td>
</tr>
<tr>
<td>给资源添加profiles, tags, and security 标签</td>
<td>[base]/[Resource]/[id]/$meta-add</td>
</tr>
<tr>
<td>删除资源的profiles, tags, and security 标签</td>
<td>[base]/[Resource]/[id]/$meta-delete</td>
</tr>
<tr>
<td>生成文档</td>
<td>[base]/Composition/$document</td>
</tr>
<tr>
<td>字典项的转换</td>
<td>[base]/ConceptMap/$translate</td>
<td>[base]/ConceptMap/[id]/$translate</td>
</tr>
<tr>
<td>批量转换字典</td>
<td>[base]/ConceptMap/$batch</td>
</tr>
<tr>
<td>Closure Table Maintenance</td>
<td>[base]/$closure</td>
</tr>
<tr>
<td>获取就诊记录</td>
<td>[base]/Encounter/[id]/$everything</td>
</tr>
<tr>
<td>获取患者的所有病历</td>
<td>[base]/Patient/$everything</td>
<td>[base]/Patient/[id]/$everything</td>
</tr>
<tr>
<td>Populate Questionnaire</td>
<td>[base]/Questionnaire/$populate</td>
<td>[base]/Questionnaire/[id]/$populate</td>
</tr>
<tr>
<td>生成调查问卷Build Questionnaire</td>
<td>[base]/StructureDefinition/$questionnaire</td>
<td>[base]/StructureDefinition/[id]/$questionnaire</td>
</tr>
<tr>
<td>扩展值集内容Value Set Expansion</td>
<td>[base]/ValueSet/$expand</td>
<td>[base]/ValueSet/[id]/$expand</td>
</tr>
<tr>
<td>字典项查询</td>
<td>[base]/ValueSet/$lookup</td>
</tr>
<tr>
<td>验证编码是否存在于某值集</td>
<td>[base]/ValueSet/$validate-code</td>
<td>[base]/ValueSet/[id]/$validate-code</td>
</tr>
<tr>
<td>批量验证</td>
<td>[base]/ValueSet/$batch</td>
</tr>
</tbody>
</table>
<p>备注:</p>
<ul>
<li>针对元数据的 operation 同样作用于既往的资源版本</li>
</ul>
<h4 id="2-2-0-2_自定义方法_Implementations_Defined_Operations">2.2.0.2 自定义方法 Implementations Defined Operations</h4><p>除了上述的operation，系统开发实现时可以定义自己的operation方法。通过使用 conformance statement符合性声明来解决不同的系统中自定义的<br>operation 之间存在的命名冲突。</p>
<p>除此之外，这些 operation或额外的运行时operation并不会影响独立于或没有和 Restful API整合在一起的operation的使用，前提是它们的寻址方案不会<br>与这里的寻址方案发生冲突。</p>
<h4 id="2-2-0-3_operation方法的定义_Defining_an_Operation">2.2.0.3 operation方法的定义 Defining an Operation</h4><p>每个Operation是通过如下内容来定义的:</p>
<ul>
<li>该operation的语境/应用场景——使用的系统、资源类型或资源实例</li>
<li>该operation的名称</li>
<li>定义好的参数</li>
</ul>
<p>要定义一个参数，需要如下信息:</p>
<ul>
<li>参数名称，出于开发实现的考虑，名称应该是有效的字符串token</li>
<li>用途——入参 | 出参 |两者都是</li>
<li>参数类型——数据类型或资源类型</li>
<li>Profile规范——表示资源中的额外约束的规范</li>
<li>文档——描述参数的使用</li>
</ul>
<p>有一种叫“Tuple”的参数类型，其中会有一些额外的部分part。每个部分和参数拥有一样的信息<br>There is a special parameter type called “Tuple” which is a parameter type that has additional parts. Each part has the same information as a parameter, except for use, which is taken from the parameter it is part of.</p>
<p>The resource Operation Definition is used to provide a computable definition of the operation.</p>
<h4 id="2-2-0-4_operation的扩展_Extending_an_Operation">2.2.0.4 operation的扩展 Extending an Operation</h4><p>开发实现时可以通过定义新的参数来扩展operation。使用<a href="operationdefinition.html">Operation Definition</a>可以自行发布你扩<br>展后的定义，其中 OperationDefinition.base指向原始的定义即可</p>
<p>注意：FHIR标准不会定义任何的以“x-”开头命名的参数。</p>
<h4 id="2-2-0-5_同步执行_operation方法_Executing_an_Operation_Synchronously">2.2.0.5 同步执行 operation方法 Executing an Operation Synchronously</h4><p>大多数情况下，operation 方法是同步执行的——客户端发送入参请求给服务器，服务器返回出参给客户端。</p>
<p>operation节点的URL 取决于具体的使用场景：</p>
<ul>
<li>系统层面：url形如[base]/$[name]</li>
<li>资源类型层面：url形如[base]/[type]/$[name]</li>
<li>资源实例层面：url形如[base]/[type]/[id]/$[name]</li>
</ul>
<h5 id="2-2-0-5-1_Operation请求_Operation_Request">2.2.0.5.1 Operation请求 Operation Request</h5><p>一般情况下，通过POST来调用operation节点。提交内容的格式是Parameters资源格式，也就是一些入参。请参考值集扩展的请求范例。<br>其中Content type的使用和RESTful  API 一样。</p>
<p>如果operation没有复杂类型的入参，称该operation是幂等的，也就是说该operation可以使用GET方法来调用，所有参数附加在URL的后面，<br>以查询参数的形式出现，跟在?的后面。服务器应支持此类调用。</p>
<p>服务器也可支持multi-part form方法提交参数，对于测试使用HTML form的operation是很有帮助的。</p>
<h5 id="2-2-0-5-2_Operation_响应_Operation_Response">2.2.0.5.2 Operation 响应 Operation Response</h5><p>如果Operation成功，HTTP 状态码应该是200 OK。如果是4xx或5xx的状态码则表示出错了，也可以返回OperationOutcome。<br>User agent应注意的是在收到客户端的operation请求时，服务器可能会要求客户端重定向来验证客户端。</p>
<p>一般情况下,当出参是一到多个的时候，响应中使用统一的Parameter资源格式。</p>
<p>如果出参只有一个，而且是一个资源的话，返回值的根元素为”return”，不会使用参数格式，响应中就只是资源内容本身</p>
<p>operation方法返回的资源可能会被保存下来，这样服务器中就可以查找该资源内容。这种情况下，返回的资源内容中会包括服务器分配的资源标识。如果响应中返回的<br>资源内容并没有持久化在服务器中，那么资源内容中就不会存在id字段</p>
<h4 id="2-2-0-6_异步执行Operation_Executing_an_Operation_Asynchronously">2.2.0.6 异步执行Operation Executing an Operation Asynchronously</h4><p>Operation也可以异步执行。这种情况下，请求端发送待执行的operation请求的消息，接收端随后返回operation的处理结果。</p>
<p>鉴于异步操作的复杂性，开发实现也会变得很复杂。异步operation的执行步骤总结如下:</p>
<ul>
<li>请求端构建消息(a bundle with type = message)</li>
<li>消息头中的event.system 值为 <a href="http://blame-Lloyd.com/operations" target="_blank" rel="external">http://blame-Lloyd.com/operations</a></li>
<li>消息头中的event.code为operation定义的URL</li>
<li>消息头的data字段指的是Parameters资源，其中的内容是operation的入参。如果没有入参的话，data字段也就不存在</li>
<li>接收端收到消息</li>
<li>待operation处理完成之后，处理端返回一到多条消息。</li>
<li>每条消息都是一个bundle，bundle.type = message，其中 MessageHeader.response.identifier的值为初始<br>请求中的id</li>
<li>如果operation处理失败，MessageHeader.response.code必须标明 失败信息，且应返回OperationOutcome资源</li>
<li>如果只有一个出参的话，而且是一个资源，根元素为”return”不会使用参数格式，MessageHeader.data中就只是资源内容本身</li>
<li>除了上面一条的其他情况下，MessageHeader.data里面是一个Parameters资源，包括的是operation的出参。如果没有出参，<br>MessageHeader.data应该不存在</li>
</ul>

        
      </div>
    
  </div>
  
    
  
</article>


</section>


      </div>
      <footer id="footer">
  <div class="footer-desc">
      
  </div>
  <div class="footer-info">
    <div class="copyright">
      &copy; 2015 wanghaisheng<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    

<script type='text/javascript' src='http://ajax.useso.com/ajax/libs/jquery/1.7.2/jquery.min.js?ver=3.4.2'></script>

<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js" type="text/javascript"></script>
  </div>
</body>
</html>
